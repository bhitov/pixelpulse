<!DOCTYPE html>
<html>
<head>

<script src='http://ajax.googleapis.com/ajax/libs/jquery/1.4.3/jquery.min.js'></script>
<script src='protovis.min.js'></script>
<script src="/socket.io/socket.io.js"></script> 

</head>
<body>

<div id='container'></div>

<script>
var w=600, h=300;

var x = pv.Scale.linear(0, 10).range(0, w)
var y = pv.Scale.linear(0, 5).nice().range(0, h)
var y2 = pv.Scale.linear(0, 0.5).nice().range(0, h)

var data = [];

var vis = new pv.Panel()
			.width(w + 5)
			.height(h + 20 + 10)
			.bottom(20)
			.left(20)
			.right(20)
			.top(5)
						
yt = vis.add(pv.Rule)
    .data(y.ticks(5))
    .bottom(y)
    .strokeStyle(function(d){return d ? "#eee" : "#000"})
	.anchor("left").add(pv.Label)
    	.text(y.tickFormat);
    
yt2 = vis.add(pv.Rule)
    .data(y2.ticks(5))
    .bottom(y2)
    .strokeStyle('rgba(0,0,0,0)')
	.anchor("right").add(pv.Label)
  		.text(y2.tickFormat);
  	



vis.add(pv.Line)
			.data(function(){return data})
			.left(function(d){return x(d.x)})
			.bottom(function(d){return y(d.y)})
			.lineWidth(3)
			.strokeStyle('blue')
			
vis.add(pv.Line)
			.data(function(){return data})
			.left(function(d){return x(d.x)})
			.bottom(function(d){return y2(d.y2)})
			.lineWidth(3)
			.strokeStyle('red')

var acc = 0;

var socket = new io.Socket(); 
socket.connect();

socket.on('connect', function(){
	console.log("connected")
})

 socket.on('message', function(m){
  	xmax = m.x
  	xmin = xmax - 10;
  	x.domain(xmin, xmax).range(0, w);
  	data.push(m)
  	if (data.length > 200) data.shift()
	vis.render()
 }) 
</script>

</body>
</html>
